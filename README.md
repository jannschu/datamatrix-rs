# datamatrix-rs

Data Matrix (ECC 200) decoding and encoding library with an optimizing encoder.

<p align="center">
  <img src="src/datamatrix-rs.png" alt="Data Matrix encoding 'datamatrix-rs'">
</p>

This library features a new, optimzing, and linear time encoder which achieves
the smallest possible encoding size.

The Data Matrix standard (ISO/IEC 16022:2006) contains a heuristic to decide
which encoding modes to use, and in most cases that works. A straightforward
implementation will not have linear runtime, though. This library uses an idea
similar to the A\* algorithm.

The optimizer is unique about this implementation. See the list of related
projects below for credits and references to other open source Data Matrix
libraries.

## Example

```rust
let bitmap = datamatrix::encode(b"Hello, World!", SymbolSize::Min).unwrap();
print!("{}", bitmap.unicode());  // print "ASCII art" version
```

The library contains _no_ noteworthy rendering. You have to write you own
renderer for whatever your desired output format is. Example code can be found
in `examples/`. The extra effort for this last rendering step is usually low and
this approach allows high flexibility.

## Status

- [x] Encodation modes ASCII, Base256, C40, Text, X12, EDIFACT implemented.
- [x] Optimizer for switching between encodation modes to find a minimal
      encodation size.
- [x] Data part decoding.
- [x] Fuzzed data de- and encoding (*no issues after 48h*)
- [x] Check the open bug reports in other implementations.
- [x] Reed Solomon de-/encoder.
- [x] Tile placement encoding.
- [x] Helpers for rendering
- [ ] Tile placement decoding.
- [ ] Visual detection in images

Things in consideration for after that:

- Refine API for better symbol size control ("at least 14x14" for example)
- ECI support (UTF-8 for example)
- "Structured Append"
- "Reader Programming"
- FCN1 and GS1

## Disclaimer

Since the encoded data is padded to fill up the remaining space in a Data Matrix
symbol, the symbol generated by this library will in many cases not be smaller
compared to an optimizer based on the heuristic defined in the specification.
What it achieves however in any case is a linear encoding time, and it avoids
some of the bugs which can be attributed to the using the heuristic (see open
bugs in zxing). And, of course, there are cases where it will return a smaller
symbol altough admittedly no thorough study of this has been done.

## Related projects

The following projects were invaluable for learning from their implementation
and stealing some of their test cases and bug reports.

- [zxing](https://github.com/zxing/zxing) is a Google library to encode
  and decode multiple 1D and 2D codes including Data Matrix. The core part
  is written in Java. It uses the heuristic from the specification.
- [barcode4j](http://barcode4j.sourceforge.net/) is a predecessor (?) of zxing,
  the Data Matrix code was forked into zxing.
- [libdmtx](https://github.com/dmtx/libdmtx) is the most promiment open source
  C library for encoding and decoding Data Matrix. It has a more limited optimizer
  compared to the specification, but is still very useable.
- [zxing-cpp](https://github.com/nu-book/zxing-cpp) is a C++ port of zxing, it
  also contains some improvements.